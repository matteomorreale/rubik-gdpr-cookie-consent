<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Floating Icon - GDPR Cookie Consent</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            line-height: 1.6;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-section h2 {
            color: #333;
            margin-top: 0;
        }
        .button {
            background-color: #0073aa;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 4px;
            margin: 5px;
        }
        .button:hover {
            background-color: #005177;
        }
        .button.secondary {
            background-color: #666;
        }
        .button.secondary:hover {
            background-color: #555;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .warning {
            color: #ffc107;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        #test-results {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Test Floating Icon - GDPR Cookie Consent</h1>
    
    <div class="test-section">
        <h2>Test 1: Verifica Presenza Elementi</h2>
        <p>Questo test verifica che tutti gli elementi necessari siano presenti nella pagina.</p>
        <button class="button" onclick="testElementsPresence()">Esegui Test</button>
        <div id="elements-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 2: Simula Consenso e Floating Icon</h2>
        <p>Questo test simula l'accettazione del consenso e verifica che la floating icon appaia.</p>
        <button class="button" onclick="simulateConsent()">Simula Consenso Accettato</button>
        <button class="button secondary" onclick="clearConsent()">Pulisci Consenso</button>
        <div id="consent-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 3: Funzionalità Floating Icon</h2>
        <p>Testa la funzionalità di click sulla floating icon.</p>
        <button class="button" onclick="testFloatingIconClick()">Test Click Floating Icon</button>
        <div id="floating-icon-test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>Test 4: Cookie Detection</h2>
        <p>Verifica la corretta lettura dei cookie di consenso.</p>
        <button class="button" onclick="testCookieDetection()">Test Cookie Detection</button>
        <div id="cookie-test-result"></div>
    </div>
    
    <div id="test-results">
        <h3>Risultati Test</h3>
        <div id="overall-results">Nessun test eseguito ancora.</div>
    </div>

    <script>
        // Simulate WordPress jQuery environment
        if (typeof jQuery === 'undefined') {
            // Load jQuery if not present
            var script = document.createElement('script');
            script.src = 'https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js';
            script.onload = function() {
                window.$ = jQuery.noConflict();
                initializeTests();
            };
            document.head.appendChild(script);
        } else {
            window.$ = jQuery;
            initializeTests();
        }

        function initializeTests() {
            // Helper functions for testing
            window.getCookie = function(name) {
                var value = "; " + document.cookie;
                var parts = value.split("; " + name + "=");
                if (parts.length === 2) {
                    return parts.pop().split(";").shift();
                }
                return null;
            };

            window.setCookie = function(name, value, days) {
                var expires = "";
                if (days) {
                    var date = new Date();
                    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                    expires = "; expires=" + date.toUTCString();
                }
                document.cookie = name + "=" + (value || "") + expires + "; path=/";
            };

            window.deleteCookie = function(name) {
                document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/';
            };
        }

        function testElementsPresence() {
            var results = [];
            var resultDiv = document.getElementById('elements-test-result');
            
            // Check for banner
            if (document.getElementById('manus-gdpr-cookie-banner')) {
                results.push('<span class="success">✓ Banner presente</span>');
            } else {
                results.push('<span class="error">✗ Banner non trovato</span>');
            }
            
            // Check for modal
            if (document.getElementById('manus-gdpr-preferences-modal')) {
                results.push('<span class="success">✓ Modal preferenze presente</span>');
            } else {
                results.push('<span class="error">✗ Modal preferenze non trovato</span>');
            }
            
            // Check for floating icon
            if (document.getElementById('manus-gdpr-floating-icon')) {
                results.push('<span class="success">✓ Floating icon presente</span>');
            } else {
                results.push('<span class="error">✗ Floating icon non trovata</span>');
            }
            
            resultDiv.innerHTML = '<h4>Risultati Test Elementi:</h4>' + results.join('<br>');
        }

        function simulateConsent() {
            var resultDiv = document.getElementById('consent-test-result');
            
            // Set consent cookie
            setCookie('manus_gdpr_consent', 'accepted', 365);
            
            var consentData = {
                status: 'accepted',
                data: {
                    necessary: true,
                    analytics: true,
                    advertising: true,
                    functional: true
                },
                timestamp: Date.now()
            };
            setCookie('manus_gdpr_consent_data', JSON.stringify(consentData), 365);
            
            // Hide banner
            var banner = document.getElementById('manus-gdpr-cookie-banner');
            if (banner) {
                banner.style.display = 'none';
            }
            
            // Show floating icon
            var floatingIcon = document.getElementById('manus-gdpr-floating-icon');
            if (floatingIcon) {
                floatingIcon.style.display = 'flex';
                floatingIcon.classList.add('show');
            }
            
            resultDiv.innerHTML = '<h4>Consenso Simulato:</h4><span class="success">✓ Cookie di consenso impostato<br>✓ Banner nascosto<br>✓ Floating icon mostrata</span>';
        }

        function clearConsent() {
            var resultDiv = document.getElementById('consent-test-result');
            
            // Clear cookies
            deleteCookie('manus_gdpr_consent');
            deleteCookie('manus_gdpr_consent_data');
            
            // Show banner
            var banner = document.getElementById('manus-gdpr-cookie-banner');
            if (banner) {
                banner.style.display = 'block';
            }
            
            // Hide floating icon
            var floatingIcon = document.getElementById('manus-gdpr-floating-icon');
            if (floatingIcon) {
                floatingIcon.style.display = 'none';
                floatingIcon.classList.remove('show');
            }
            
            resultDiv.innerHTML = '<h4>Consenso Rimosso:</h4><span class="warning">⚠ Cookie di consenso rimosso<br>⚠ Banner ripristinato<br>⚠ Floating icon nascosta</span>';
        }

        function testFloatingIconClick() {
            var resultDiv = document.getElementById('floating-icon-test-result');
            var floatingIcon = document.getElementById('manus-gdpr-floating-icon');
            var modal = document.getElementById('manus-gdpr-preferences-modal');
            
            if (!floatingIcon) {
                resultDiv.innerHTML = '<span class="error">✗ Floating icon non trovata</span>';
                return;
            }
            
            if (!modal) {
                resultDiv.innerHTML = '<span class="error">✗ Modal preferenze non trovato</span>';
                return;
            }
            
            // Make sure floating icon is visible for test
            floatingIcon.style.display = 'flex';
            
            // Simulate click
            floatingIcon.click();
            
            // Check if modal is visible
            if (modal.style.display === 'block' || $(modal).is(':visible')) {
                resultDiv.innerHTML = '<h4>Test Click Floating Icon:</h4><span class="success">✓ Click simulato con successo<br>✓ Modal preferenze aperto</span>';
            } else {
                resultDiv.innerHTML = '<h4>Test Click Floating Icon:</h4><span class="error">✗ Modal non si è aperto dopo il click</span>';
            }
        }

        function testCookieDetection() {
            var resultDiv = document.getElementById('cookie-test-result');
            var results = [];
            
            // Test consent cookie
            var consentCookie = getCookie('manus_gdpr_consent');
            if (consentCookie) {
                results.push('<span class="success">✓ Cookie consenso trovato: ' + consentCookie + '</span>');
            } else {
                results.push('<span class="warning">⚠ Cookie consenso non trovato</span>');
            }
            
            // Test detailed consent data cookie
            var consentDataCookie = getCookie('manus_gdpr_consent_data');
            if (consentDataCookie) {
                try {
                    var data = JSON.parse(consentDataCookie);
                    results.push('<span class="success">✓ Cookie dati consenso trovato e parsato</span>');
                    results.push('<span class="success">Status: ' + data.status + '</span>');
                } catch (e) {
                    results.push('<span class="error">✗ Cookie dati consenso trovato ma non valido</span>');
                }
            } else {
                results.push('<span class="warning">⚠ Cookie dati consenso non trovato</span>');
            }
            
            resultDiv.innerHTML = '<h4>Test Cookie Detection:</h4>' + results.join('<br>');
        }

        // Auto-run basic test on page load
        window.addEventListener('load', function() {
            setTimeout(function() {
                testElementsPresence();
                testCookieDetection();
            }, 1000);
        });
    </script>
</body>
</html>
